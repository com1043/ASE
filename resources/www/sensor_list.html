<!DOCTYPE html>
<html>
    <head>
        
        <script type="module">
//통신모듈
import * as COMM from './CommModule.js';

function addItem(key, on)   //table -> div 수정
{ 
    
    var state = on? "checked": "";
    var eItem = document.createElement("table");
    eItem.id = key;
    eItem.className = 'item';
    eItem.innerHTML = [
        '<tbody><tr><td class="title">',
        key,
        '</td>',
        '<td></td>',
        '<td>',
        '<label class="switch">',
        '<input id="',
        key+"stat",
        '" type="checkbox"',
        state,
        '>',
        '<div class="slider round"></div>',
        '</label>',
        '</td>',
        '<td>',
        '<button class="item-btn" onclick="location.href=`manage_sensor_info.html`">VIEW</button>',
        '</td>',
        '</tr></tbody>',
    ].join("");
    document.getElementById('items').append(eItem);
}

var commModule = new COMM.CommModule(function()
{
    console.log("commModule load");
    console.log(commModule.sessionUUID);

    var sensorListCh = commModule.createChannel("SensorListRequest",null, (e)=>
    {
        console.log("data:"+e.data);
        var data = JSON.parse(e.data);
        console.log(data);
        console.log("count:" + data.count)
        console.log("id:" + data.data[0].id)
       for(var i in data.data)// 센서 수 만큼 반복문
        {
            addItem(data.data[i].id, data.data[i].on);
           
        }
        sensorListCh.close();

        
    });

    //gg

    var sensorOnOffCh = commModule.createChannel("RealtimeAllSensorOnOffRequest",null, (e)=>
    {
        console.log(e.data);
    });
});
window.onload = function()
{
    
    
}

        </script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>MEERKEEP</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="shortcut icon" href="image/logo_telco.png">
        <link type="text/css" rel="stylesheet" href="css/style.css">

</head>
<body>
    <header>
        <div>
            <img class="logo" src="image/logo_meerkeep.png" alt="">
            <div id="total" class="text1"></div>
        </div>
    </header>
    <section id="items" class="items">
    </section>
</body>
</html>
