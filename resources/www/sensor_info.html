<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>sensor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="image/logo_telco.png">
    <link type="text/css" rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <script src="sensor_info/manage_sensor_info.js"></script>
    <script type="module">
                    //통신모듈
import * as COMM from './CommModule.js';

// 서버로부터 데이터를 받은 모듈
var commModule = new COMM.CommModule(function()
{
    console.log("commModule load");
    console.log(commModule.sessionUUID);
});
window.onload = function()
{
	var sensorID = getParameter("key");
	dataSetKey(sensorID);
    var sensorData = commModule.createChannel("RealtimeSensorDataRequest",()=>
	{
		sensorData.send(sensorID);
	}, (e)=>
	{
		var data = JSON.parse(e.data);
		if(data.result == true)
		{
			console.log(Object.keys(data).length);
			if(Object.keys(data).length > 1)
			{
				var time = data.time.split("/");
				setSensorData(new Date(time[0], time[1], time[2], time[3], time[4], time[5]), data.xg, data.yg, data.xa, data.ya, data.za, data.al);
			}
		}
		else
		{
			sensorData.close();
		}
	});

    var sensorOnOff = commModule.createChannel("RealtimeSensorOnOffRequest",()=>
    {
		sensorOnOff.send(sensorID);
    }, (e)=>
    {
		var data = e.data.split("/");
		if(data[0] == "result" && data[1] != "true")
		{
			sensorOnOff.close();
		}
		else if(data[0] == "state")
		{
			setState(data[1] == "true");
		}
    });
    // log Bottom
    window.scrollTo(0,document.body.scrollHeight);
}
    </script>
    
</head>

<body>
    <section class="sensor">
        <header>
            <div>
                <i class="fas fa-caret-square-left fa-2x back_btn" onclick="history.back(-1);"></i>
                <div class="right_empty"></div>
                <span class="text2"><span id="state_name" class="text2_name"></span><span id="state" class="info_on"></span></span>
            </div>
        </header>
        <div></div>
        <div class="state">
            <div>
                <div class="graph_item">기울기</div>
                <label class="pos"> <span class="pos2">X</span> <span id="slopX"></span> <span class="unit">deg</span></label>
                <label class="pos"> <span class="pos2">Y</span> <span id="slopY" ></span> <span class="unit">deg</span></label>
            </div>
            <div>
                <div class="graph_item">가속도</div>
                <label class="pos"> <span class="pos2">X</span> <span id="accX"></span> <span class="unit">deg</span></label>
                <label class="pos"> <span class="pos2">Y</span> <span id="accY"></span> <span class="unit">mG</span></label>
                <label class="pos"> <span class="pos2">Z</span> <span id="accZ"></span> <span class="unit">mG</span></label>
            </div>
            <div>
                <div class="graph_item">고도</div>
                <label class="pos"> <span class="pos2">A</span> <span id="alti"></span> <span class="unit">M</span></label>
            </div>
        </div>
        <hr/>
        <div>
            <div>데이터 수집 시간</div>
            <div id="uptime"></div>
        </div>
        <hr/>
    </section>
    <article>
        <div>센서 로그</div>
        <div id="log" class="logs"></div>
    </article>
</body>

</html>